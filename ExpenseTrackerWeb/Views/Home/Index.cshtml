@model DashboardViewModel

<h4>Yearly Transactions</h4>
<hr />

<table class="table table-striped" id="mainGrid">
    <thead>
        <tr>
            <th>Category Name</th>
            <th>Sub Category Name</th>
            <th>January</th>
            <th>February</th>
            <th>March</th>
            <th>April</th>
            <th>May</th>
            <th>June</th>
            <th>July</th>
            <th>August</th>
            <th>September</th>
            <th>October</th>
            <th>November</th>
            <th>December</th>
        </tr>
    </thead>
    <tbody>
        @if (Model.TransactionByYear != null && Model.TransactionByYear.Any())
        {
            @foreach (var transaction in Model.TransactionByYear)
            {
                <tr>
                    <td>@transaction.CategoryName</td>
                    <td>@transaction.SubCategoryName</td>
                    <td>@transaction.January.ToString("C")</td>
                    <td>@transaction.February.ToString("C")</td>
                    <td>@transaction.March.ToString("C")</td>
                    <td>@transaction.April.ToString("C")</td>
                    <td>@transaction.May.ToString("C")</td>
                    <td>@transaction.June.ToString("C")</td>
                    <td>@transaction.July.ToString("C")</td>
                    <td>@transaction.August.ToString("C")</td>
                    <td>@transaction.September.ToString("C")</td>
                    <td>@transaction.October.ToString("C")</td>
                    <td>@transaction.November.ToString("C")</td>
                    <td>@transaction.December.ToString("C")</td>
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="14" class="text-center">No transactions found.</td>
            </tr>
        }
    </tbody>
</table>

<h4>Bank Summary</h4>
<hr />

<table class="table table-striped">
    <thead>
        <tr>
            <th>Bank Name</th>
            <th>Total Income</th>
            <th>Total Expense</th>
            <th>Balance</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var bank in Model.BankByYear)
        {
            <tr>
                <td>@bank.BankName</td>
                <td>@bank.TotalIncome.ToString("C")</td>
                <td>@bank.TotalExpense.ToString("C")</td>
                <td>@bank.Balance.ToString("C")</td>
            </tr>
        }
    </tbody>
</table>

<table id="transactionGrid" class="table">
    <thead>
        <tr>
            <th>Amount</th>
            <th>Bank</th>
            <th>Comment</th>
            <th>Created Date</th>
            <th>Category Name</th>
            <th>Sub Category Name</th>
        </tr>
    </thead>
    <tbody id="transactionBody">
        <!-- Rows will be added here dynamically -->
    </tbody>
</table>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Example date range
        var startDate = '2024-01-01'; // Replace with actual start date
        var endDate = '2024-12-31';   // Replace with actual end date

        // Handle cell click
        $('#mainGrid').on('click', 'td', function () {
            var cell = $(this);
            var headerText = $(this).closest('table').find('thead th').eq(cell.index()).text();
            var row = cell.closest('tr');
            var secondColumnValue = row.find('td').eq(1).text();
            var columnValue = cell.text();

            // Prepare data to send
            var requestData = {
                month: headerText,
                category: secondColumnValue // Adjust this according to your actual data
            };

            $.ajax({
                url: '@Url.Action("GetTransactionData", "Home")', // Adjust this URL as needed
                type: 'GET',
                data: requestData,
                success: function (response) {
                    // Handle response

                    var tableBody = $('#transactionBody');
                    tableBody.empty(); // Clear existing content

                    $.each(response.data, function (index, item) {
                        var row = `<tr data-id="${item.Id}">
                                                    <td>${item.Amount}</td>
                                                    <td>${item.Bank}</td>
                                                    <td>${item.Comment}</td>
                                                    <td>${item.CreatedDate}</td>
                                                    <td>${item.CategoryName}</td>
                                                    <td>${item.SubCategoryName}</td>
                                                </tr>`;

                        tableBody.append(row);
                    });

                    console.log(response);
                },
                error: function (e) {
                    alert('Failed to send data.' + e);
                }
            });
        });
    });
</script>
